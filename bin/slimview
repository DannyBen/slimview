#!/usr/bin/env ruby
args = ARGV.dup

if args.include?('--help') || args.include?('-h')
  puts <<~HELP
    Usage: slimview [options]

    Options:
      -p, --port PORT     Set the port to run the server on (default: 3000)
      -r, --root PATH     Set the root templates directory (default: ./templates)
      -a, --assets PATH   Set the assets directory (default: <root>/assets)
      -h, --help          Show this help message
      -v, --version       Print version info

    Environment Variables:
      SLIMVIEW_PORT     Set the port
      SLIMVIEW_ROOT     Set the root templates directory
      SLIMVIEW_ASSETS   Set the assets directory

  HELP
  exit
end

require 'slimview'

if args.include?('--version') || args.include?('-v')
  puts Slimview::VERSION
  exit
end

port = nil
root = nil
assets = nil

def fetch_arg(args, *flags)
  flags.each do |flag|
    if (index = args.index(flag))
      return args[index + 1]
    end
  end
  nil
end

port = fetch_arg(args, '--port', '-p')
root = fetch_arg(args, '--root', '-r')
assets = fetch_arg(args, '--assets', '-a')

port = port.to_i if port

server = Slimview::Server.new port: port, root: root, assets: assets
server.start
